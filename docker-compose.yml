
services:
  cheques:
    container_name: cheques
    build:
      context: .
      dockerfile: Dockerfile
    image: cheques:local
    restart: unless-stopped

    # Ports : PORT_HOST -> PORT_CONTAINER
    ports:
      - "${CHEQUES_PORT_HOST:-8081}:${SERVER_PORT:-8080}"

    environment:
      # Profil Spring
      SPRING_PROFILES_ACTIVE: "${SPRING_PROFILES_ACTIVE:-prod}"

      # Port interne Spring (doit matcher application-prod.properties)
      SERVER_PORT: "${SERVER_PORT:-8080}"

      # Exemple DB (si tu nâ€™as pas encore de DB, laisse vide ou commente)
      DB_URL: "${DB_URL:-}"
      DB_USER: "${DB_USER:-}"
      DB_PASSWORD: "${DB_PASSWORD:-}"

      # JVM options (optionnel)
      JAVA_OPTS: "${JAVA_OPTS:--XX:MaxRAMPercentage=75 -XX:+UseG1GC}"

    healthcheck:
      test: ["CMD-SHELL", "wget -qO- http://127.0.0.1:${SERVER_PORT:-8080}/actuator/health | grep -q UP || exit 1"]
      interval: 15s
      timeout: 3s
      retries: 5
      start_period: 20s

    # Optionnel : logs plus lisibles (Docker)
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
